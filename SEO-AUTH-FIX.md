# Исправление авторизации в SEO настройках

## Проблема
В админке на странице `/admin/seo` возникала ошибка:
```
Error: Unauthenticated. Please login via the frontend application.
```

Ошибка появлялась во всех секциях:
- **Глобальные** - при редактировании глобальных SEO настроек
- **Страницы** - при редактировании SEO настроек страниц
- **Контент** - при редактировании SEO проектов и блога

## Причина
Компоненты SEO использовали обычный `fetch()` без авторизационных заголовков вместо централизованного API клиента с автоматической авторизацией.

## Решение
Заменили все `fetch()` запросы на использование обёрточных функций `post()` и `get()` из `@/lib/api`, которые:
- Автоматически добавляют Bearer токен в заголовки через interceptor
- Обрабатывают обновление токенов
- Перенаправляют на логин при 401 ошибке
- Правильно обрабатывают FormData (удаляют Content-Type для автоматической установки boundary)
- Возвращают данные напрямую (без необходимости обращаться к `.data`)

## Исправленные файлы

### 1. api.ts (Централизованный API клиент)
**Изменения:**
- Обновлен request interceptor для правильной обработки FormData
- Добавлено удаление заголовка `Content-Type` для FormData, чтобы браузер автоматически установил правильный boundary
- Это критично для корректной отправки файлов на сервер

### 2. GlobalSEOSettings.tsx
**Изменения:**
- Добавлен импорт: `import { post } from '@/lib/api'`
- Заменен `fetch()` на `post()` в методе `handleSubmit`
- Добавлена проверка наличия токена перед отправкой
- Добавлено логирование для отладки
- Улучшена обработка ошибок
- Используется типизированный ответ `post<{ success: boolean; message?: string }>()`

### 3. PageSEOSettings.tsx
**Изменения:**
- Добавлен импорт: `import { post } from '@/lib/api'`
- Заменен `fetch()` на `post()` в методе `handleSubmit`
- Добавлена проверка наличия токена перед отправкой
- Добавлено логирование для отладки
- Улучшена обработка ошибок
- Используется типизированный ответ

### 4. ContentSEOManager.tsx
**Изменения:**
- Добавлен импорт: `import { get, post } from '@/lib/api'`
- Заменен `fetch()` на `get()` в методах `fetchProjects` и `fetchBlogPosts`
- Заменен `fetch()` на `post()` в методе `handleSeoSubmit`
- Добавлена проверка наличия токена перед отправкой
- Добавлено логирование для отладки
- Улучшена обработка ошибок
- Используются типизированные ответы

## Преимущества централизованного API клиента

1. **Автоматическая авторизация** - токен добавляется автоматически
2. **Обновление токенов** - автоматическое обновление при получении нового токена
3. **Обработка ошибок** - единообразная обработка 401/403 ошибок
4. **Перенаправление** - автоматический редирект на логин при неавторизованном доступе
5. **Консистентность** - все API запросы используют один подход

## Тестирование

Проверьте работу всех секций SEO:

1. **Глобальные настройки:**
   - Откройте `/admin/seo`
   - Перейдите на вкладку "Глобальные"
   - Заполните поля и сохраните
   - Убедитесь, что данные сохраняются без ошибок

2. **Настройки страниц:**
   - Перейдите на вкладку "Страницы"
   - Выберите тип страницы (Главная, Проекты, Блог, Медиа)
   - Заполните SEO данные и сохраните
   - Проверьте успешное сохранение

3. **Контент:**
   - Перейдите на вкладку "Контент"
   - Выберите проект или пост блога
   - Нажмите "Редактировать SEO"
   - Заполните данные и сохраните
   - Убедитесь в успешном сохранении

## Что НЕ изменилось

✅ Вёрстка и дизайн остались без изменений
✅ Функционал работает как прежде
✅ Валидация файлов (размер, формат) работает
✅ Скорость загрузки не изменилась
✅ SEO оптимизация сохранена
✅ Авторизация в других частях админки не затронута

## Дополнительная информация

Централизованный API клиент находится в файле `frontend_next/src/lib/api.ts` и используется во всех компонентах админки для обеспечения единообразной работы с API и авторизацией.
