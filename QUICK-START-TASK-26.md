# Quick Start Guide - Task 26 Testing

## Быстрый старт тестирования автоматического обновления токенов

### Шаг 1: Автоматическая проверка кода

```powershell
.\test-token-refresh-simple.ps1
```

Должно показать: **11/11 проверок пройдено ✅**

---

### Шаг 2: Запуск серверов

```bash
# Terminal 1 - Backend
cd backend_laravel
php artisan serve

# Terminal 2 - Frontend
cd frontend_next
npm run dev
```

---

### Шаг 3: Базовое тестирование в браузере

1. Откройте `http://localhost:3000/admin/login`
2. Войдите в систему
3. Откройте DevTools (F12)
4. Перейдите на вкладку **Network**
5. Работайте в админке (переходите между страницами)

**Что искать:**
- В Response Headers ищите `X-New-Token` (появится когда токен близок к истечению)

---

### Шаг 4: Симуляция истечения токена

В Console браузера выполните:

```javascript
const exp = new Date(Date.now() + 25 * 60 * 1000);
localStorage.setItem('admin-token-expires-at', exp.toISOString());
```

Подождите до 5 минут и проверьте:
- ✅ В Network появился `X-New-Token` header
- ✅ Cookie `admin-token` обновился
- ✅ Работа не прервалась

---

### Шаг 5: Интерактивный монитор (опционально)

Откройте в браузере: `test-token-refresh-monitor.html`

Эта страница покажет:
- Статус токена в реальном времени
- Countdown до следующей проверки
- Логи всех событий
- Статистику обновлений

---

## Критерии успеха

- [x] Токен обновляется автоматически за 30 минут до истечения
- [x] X-New-Token header присутствует в ответах API
- [x] Новый токен сохраняется в cookie
- [x] Обновление происходит без прерывания работы
- [x] Hook проверяет токен каждые 5 минут

---

## Полная документация

Для детального тестирования см.:
- `TASK-26-TOKEN-REFRESH-TESTING.md` - подробное руководство
- `TASK-26-COMPLETION-REPORT.md` - отчёт о выполнении

---

## Troubleshooting

**Проблема:** X-New-Token не появляется

**Решение:** Токен обновляется только за 30 минут до истечения. Используйте симуляцию (Шаг 4).

**Проблема:** Frontend не читает X-New-Token

**Решение:** Проверьте CORS в `backend_laravel/config/cors.php` - должен быть в `exposed_headers`.

**Проблема:** Токен не обновляется автоматически

**Решение:** Проверьте, что `useTokenRefresh()` вызывается в `admin/layout.tsx`.

---

**Время тестирования:** ~10-15 минут  
**Сложность:** Средняя  
**Статус:** ✅ Готово к тестированию
