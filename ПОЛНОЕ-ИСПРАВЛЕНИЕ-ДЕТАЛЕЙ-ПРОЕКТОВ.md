# Полное исправление деталей проектов - Hero и блоки

## Проблема
При добавлении Hero групп или блоков медиа возникала ошибка:
```
SyntaxError: Unexpected token '<', "<!-- Pleas"... is not valid JSON
```

## Причина
В файле `frontend_next/src/app/admin/projects/[slug]/page.tsx` оставалось множество вызовов `fetch()` без токенов аутентификации для работы с Hero медиа и блоками.

## Все исправленные функции

### Hero Media (Героические изображения)

1. **Обновление Hero группы** - `handleSaveHeroMedia()`
   - Было: `fetch(${apiUrl}/api/projects/${slug}/detail/update-media)`
   - Стало: `apiClient.post(/api/projects/${slug}/detail/update-media)`

2. **Создание новой Hero группы** - `handleCreateHeroGroup()`
   - Было: `fetch(${apiUrl}/api/projects/${slug}/detail/update-media)`
   - Стало: `apiClient.post(/api/projects/${slug}/detail/update-media)`

3. **Удаление Hero группы** - `handleDeleteHeroGroup()`
   - Было: `fetch(${apiUrl}/api/projects/${slug}/detail/hero-media/${id}, DELETE)`
   - Стало: `apiClient.delete(/api/projects/${slug}/detail/hero-media/${id})`

### Project Blocks (Блоки контента)

4. **Создание блока** - `handleCreateBlock()`
   - Было: `fetch(${apiUrl}/api/projects/${slug}/blocks, POST)`
   - Стало: `apiClient.post(/api/projects/${slug}/blocks)`

5. **Удаление блока** - `handleDeleteBlock()`
   - Было: `fetch(${apiUrl}/api/projects/${slug}/blocks/${id}, DELETE)`
   - Стало: `apiClient.delete(/api/projects/${slug}/blocks/${id})`

6. **Редактирование текста блока** - `handleSaveBlockText()`
   - Было: `fetch(${apiUrl}/api/projects/${slug}/blocks/${id}, PUT)`
   - Стало: `apiClient.put(/api/projects/${slug}/blocks/${id})`

### Block Media (Медиа блоков)

7. **Создание/обновление медиа блока** - `handleSaveBlockMedia()`
   - Было: `fetch(${apiUrl}/api/projects/${slug}/blocks/${blockId}/media, POST)`
   - Стало: `apiClient.post(/api/projects/${slug}/blocks/${blockId}/media)`

8. **Удаление медиа блока** - `handleDeleteBlockMedia()`
   - Было: `fetch(${apiUrl}/api/projects/${slug}/blocks/${blockId}/media/${id}, DELETE)`
   - Стало: `apiClient.delete(/api/projects/${slug}/blocks/${blockId}/media/${id})`

## Паттерн замены

### Для GET запросов:
```typescript
// ❌ Было
const response = await fetch(`${apiUrl}/api/endpoint`)
const data = await response.json()

// ✅ Стало
const response = await apiClient.get('/api/endpoint')
const data = response.data
```

### Для POST запросов с FormData:
```typescript
// ❌ Было
const response = await fetch(`${apiUrl}/api/endpoint`, {
  method: 'POST',
  body: formData
})
const data = await response.json()

// ✅ Стало
const response = await apiClient.post('/api/endpoint', formData, {
  headers: { 'Content-Type': 'multipart/form-data' }
})
const data = response.data
```

### Для PUT запросов:
```typescript
// ❌ Было
const response = await fetch(`${apiUrl}/api/endpoint`, {
  method: 'PUT',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(data)
})
const result = await response.json()

// ✅ Стало
const response = await apiClient.put('/api/endpoint', data)
const result = response.data
```

### Для DELETE запросов:
```typescript
// ❌ Было
const response = await fetch(`${apiUrl}/api/endpoint`, {
  method: 'DELETE'
})
const data = await response.json()

// ✅ Стало
const response = await apiClient.delete('/api/endpoint')
const data = response.data
```

## Изменения в обработке ответов

### Было (с fetch):
```typescript
if (response.ok && data.success) {
  // успех
} else {
  setError(data.message || `Ошибка: ${response.status}`)
}
```

### Стало (с apiClient):
```typescript
if (data.success) {
  // успех
} else {
  setError(data.message || 'Ошибка')
}
```

## Удалено использование apiUrl

Переменная `apiUrl` больше не нужна, так как `apiClient` уже знает базовый URL из конфигурации:
```typescript
// apiClient настроен в @/lib/api.ts
const apiClient = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000',
  // ...
});
```

## Тестирование

После исправления проверьте:

### Hero Media
1. Откройте проект: `http://localhost:3000/admin/projects/[slug]`
2. ✅ Создайте новую Hero группу (single/double)
3. ✅ Загрузите изображения/видео
4. ✅ Отредактируйте существующую Hero группу
5. ✅ Удалите Hero группу

### Блоки
1. ✅ Создайте новый блок контента
2. ✅ Отредактируйте текст блока
3. ✅ Удалите блок

### Медиа блоков
1. ✅ Добавьте медиа к блоку (single/double)
2. ✅ Загрузите изображения/видео с постерами
3. ✅ Отредактируйте медиа блока
4. ✅ Удалите медиа группу блока

Все операции должны работать без ошибок "not valid JSON".

## Итог

Заменено **8 функций** с `fetch()` на `apiClient`:
- 3 функции для Hero Media
- 3 функции для Project Blocks
- 2 функции для Block Media

Теперь все операции с деталями проектов работают с правильной аутентификацией.
