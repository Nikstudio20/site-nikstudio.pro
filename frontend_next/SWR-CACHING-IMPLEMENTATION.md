# SWR Caching Implementation

## Обзор

Реализовано кэширование API ответов с использованием библиотеки SWR (stale-while-revalidate) для оптимизации производительности админ-панели.

## Установленные зависимости

```bash
npm install swr --legacy-peer-deps
```

## Созданные файлы

### 1. Hooks для кэширования данных

#### `/src/hooks/useCategories.ts`
Hook для кэширования категорий проектов.

**Настройки кэширования:**
- Интервал обновления: 5 минут (300000 мс)
- Обновление при фокусе: отключено
- Обновление при переподключении: отключено
- Дедупликация запросов: 2 секунды

**Использование:**
```typescript
import { useCategories } from '@/hooks/useCategories';

function MyComponent() {
  const { categories, isLoading, isError, mutate } = useCategories();
  
  // categories - массив категорий
  // isLoading - состояние загрузки
  // isError - ошибка загрузки
  // mutate - функция для ручного обновления данных
}
```

#### `/src/hooks/useSEOSettings.ts`
Hook для кэширования глобальных SEO настроек.

**Настройки кэширования:**
- Интервал обновления: 10 минут (600000 мс)
- Обновление при фокусе: отключено
- Обновление при переподключении: отключено
- Дедупликация запросов: 5 секунд

**Использование:**
```typescript
import { useSEOSettings } from '@/hooks/useSEOSettings';

function MyComponent() {
  const { settings, isLoading, isError, mutate } = useSEOSettings();
  
  // settings - объект с SEO настройками или null
  // isLoading - состояние загрузки
  // isError - ошибка загрузки
  // mutate - функция для ручного обновления данных
}
```

#### `/src/hooks/useProjects.ts`
Hook для кэширования списка проектов.

**Настройки кэширования:**
- Интервал обновления: 2 минуты (120000 мс)
- Обновление при фокусе: отключено
- Обновление при переподключении: включено
- Дедупликация запросов: 2 секунды

**Использование:**
```typescript
import { useProjects } from '@/hooks/useProjects';

function MyComponent() {
  const { projects, isLoading, isError, mutate } = useProjects();
  
  // projects - массив проектов
  // isLoading - состояние загрузки
  // isError - ошибка загрузки
  // mutate - функция для ручного обновления данных
}
```

### 2. Глобальная конфигурация SWR

#### `/src/lib/swr-config.tsx`
Провайдер с глобальными настройками SWR для всей админ-панели.

**Глобальные настройки:**
- Дедупликация запросов: 2 секунды
- Обновление при фокусе: отключено (для админки не нужно)
- Обновление при переподключении: включено
- Показ устаревших данных во время обновления: включено
- Повторные попытки при ошибке: до 3 раз
- Интервал между попытками: 1 секунда

## Интеграция в приложение

### Admin Layout
SWR Provider интегрирован в `/src/app/admin/layout.tsx`:

```typescript
import { SWRProvider } from "@/lib/swr-config"

export default function Layout({ children }: { children: React.ReactNode }) {
  return (
    <SWRProvider>
      {/* остальной код */}
    </SWRProvider>
  )
}
```

### Обновленные страницы

#### 1. `/src/app/admin/category/page.tsx`
Заменены прямые fetch запросы на `useCategories()` hook.

**Изменения:**
- Удалена функция `fetchCategories` с fetch запросом
- Добавлен `useCategories()` hook
- Функция `fetchCategories` теперь вызывает `mutate()` для обновления кэша
- Автоматическое обновление данных каждые 5 минут

#### 2. `/src/app/admin/projects/page.tsx`
Заменены прямые fetch запросы на SWR hooks.

**Изменения:**
- Удалены функции `getData()`, `getCategories()`, `getGlobalSEOSettings()`
- Добавлены hooks: `useProjects()`, `useCategories()`, `useSEOSettings()`
- После создания проекта вызывается `mutateProjects()` для обновления кэша
- Автоматическое обновление данных согласно настройкам каждого hook

## Преимущества реализации

### 1. Производительность
- **Кэширование**: Данные кэшируются в памяти, повторные запросы не отправляются на сервер
- **Дедупликация**: Множественные одновременные запросы к одному endpoint объединяются в один
- **Stale-while-revalidate**: Показываются кэшированные данные, пока идет обновление в фоне

### 2. Пользовательский опыт
- **Мгновенная загрузка**: Кэшированные данные отображаются мгновенно
- **Плавные переходы**: Нет мерцания при переходах между страницами
- **Актуальность данных**: Автоматическое обновление в фоне

### 3. Оптимизация сети
- **Меньше запросов**: Данные загружаются только когда необходимо
- **Умное обновление**: Разные интервалы для разных типов данных
- **Экономия трафика**: Повторное использование кэшированных данных

## Настройки кэширования по типам данных

| Тип данных | Интервал обновления | Причина |
|-----------|-------------------|---------|
| Категории | 5 минут | Редко меняются |
| SEO настройки | 10 минут | Очень редко меняются |
| Проекты | 2 минуты | Могут обновляться чаще |

## Ручное обновление данных

Все hooks возвращают функцию `mutate()` для ручного обновления:

```typescript
const { categories, mutate } = useCategories();

// После создания/обновления/удаления категории
await mutate();
```

## Отключение revalidateOnFocus

Для админ-панели отключено автоматическое обновление при фокусе окна, так как:
1. Администраторы часто переключаются между вкладками
2. Данные в админке меняются только через действия администратора
3. Избыточные запросы при каждом фокусе не нужны

## Мониторинг и отладка

SWR Provider логирует все события:
- Успешные загрузки: `console.log('SWR Success for key "..."')`
- Ошибки: `console.error('SWR Error for key "..."')`

## Дальнейшие улучшения

Можно добавить кэширование для:
- Блог постов
- SEO страниц
- Медиа файлов
- Настроек пользователя

Просто создайте новый hook по аналогии с существующими.

## Требования

Соответствует требованию **7.6** из спецификации:
- ✅ Установлена библиотека SWR
- ✅ API вызовы для статических данных обернуты в SWR hooks
- ✅ Настроены revalidation intervals для разных типов данных
- ✅ Отключен revalidateOnFocus для данных, которые редко меняются
