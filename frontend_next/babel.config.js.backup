/**
 * Babel Configuration for Cross-Browser Compatibility
 * Handles JavaScript polyfill transformation for older browsers
 */

module.exports = {
  presets: [
    // Next.js preset (includes React and other optimizations)
    [
      'next/babel',
      {
        'preset-env': {
          // Use browserslist configuration
          useBuiltIns: 'usage', // Only include polyfills that are used
          corejs: {
            version: 3, // Use core-js version 3
            proposals: true // Include stage 3 proposals
          },
          // Target browsers based on browserslist
          targets: {
            browsers: [
              '> 0.5%',
              'last 2 versions',
              'not dead',
              'not ie <= 11',
              'Chrome >= 80',
              'Firefox >= 78',
              'Safari >= 12',
              'Edge >= 79'
            ]
          },
          // Debug mode (set to true for development debugging)
          debug: process.env.NODE_ENV === 'development' && process.env.BABEL_DEBUG === 'true'
        }
      }
    ]
  ],
  plugins: [
    // Additional plugins for compatibility
    [
      '@babel/plugin-transform-runtime',
      {
        corejs: 3,
        helpers: true,
        regenerator: true,
        useESModules: false
      }
    ]
  ],
  // Environment-specific configuration
  env: {
    development: {
      plugins: [
        // Development-only plugins
      ]
    },
    production: {
      plugins: [
        // Production optimizations
        ['transform-remove-console', { exclude: ['error', 'warn'] }]
      ]
    },
    test: {
      presets: [
        [
          'next/babel',
          {
            'preset-env': {
              targets: {
                node: 'current'
              }
            }
          }
        ]
      ]
    }
  }
};