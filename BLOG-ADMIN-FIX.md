# Исправление админки блога

## Проблема
В админке блога не работали следующие функции:
1. Создание новой статьи
2. Редактирование статьи
3. Создание блоков внутри статьи
4. Редактирование блоков

## Причина
Все API запросы в блоге использовали прямой `fetch()` без токенов аутентификации, в то время как backend требует аутентификацию через middleware `auth:sanctum`.

В других разделах админки (например, проекты) используется `apiClient` из `@/lib/api`, который автоматически:
- Добавляет токен авторизации в заголовки запросов
- Обрабатывает обновление токенов
- Управляет ошибками аутентификации

## Решение
Заменены все прямые вызовы `fetch()` на использование `apiClient` в следующих файлах:

### 1. `frontend_next/src/app/admin/blog/page.tsx`
- ✅ Добавлен импорт `apiClient`
- ✅ Функция `getData()` - загрузка списка постов
- ✅ Функция `getGlobalSEOSettings()` - загрузка SEO настроек
- ✅ Функция `checkApiConnection()` - проверка соединения
- ✅ Функция `handleSEOImageUpload()` - загрузка SEO изображений
- ✅ Функция `handleSubmit()` - создание новой статьи

### 2. `frontend_next/src/app/admin/blog/[slug]/page.tsx`
- ✅ Добавлен импорт `apiClient`
- ✅ Компонент `EditBlockDialog` - функция `handleSubmit()` для редактирования блока
- ✅ Компонент `DeleteBlockDialog` - функция `handleDelete()` для удаления блока
- ✅ Функция `fetchPost()` - загрузка поста со всеми блоками
- ✅ Функция `handleCreateBlock()` - создание нового блока

### 3. `frontend_next/src/app/admin/blog/columns.tsx`
- ✅ Добавлен импорт `apiClient`
- ✅ Функция `fetchGlobalSEOSettings()` - загрузка SEO настроек
- ✅ Функция `handleSEOImageUpload()` - загрузка SEO изображений
- ✅ Компонент `EditCell` - функция `handleSubmit()` для редактирования статьи
- ✅ Компонент `DeleteCell` - функция `handleDelete()` для удаления статьи
- ✅ Компонент `SortOrderCell` - функция `handleSave()` для изменения порядка
- ✅ Компонент `StatusCell` - функция `handleStatusChange()` для изменения статуса

## Изменения в коде

### Было (пример):
```typescript
const response = await fetch(`${API_BASE_URL}/blog-posts`, {
  method: "POST",
  body: formData,
  headers: {
    'Accept': 'application/json',
  },
  credentials: 'include',
  mode: 'cors',
});

if (!response.ok) {
  // обработка ошибок
}

const result = await response.json();
```

### Стало:
```typescript
const result = await apiClient.post('/api/blog-posts', formData, {
  headers: { 'Content-Type': 'multipart/form-data' }
});
```

## Преимущества нового подхода
1. ✅ Автоматическая аутентификация - токены добавляются автоматически
2. ✅ Автоматическое обновление токенов при истечении
3. ✅ Единообразная обработка ошибок
4. ✅ Меньше кода - не нужно вручную проверять статусы и парсить JSON
5. ✅ Централизованное управление API запросами
6. ✅ Автоматический редирект на страницу логина при 401 ошибке

## Тестирование
После исправлений необходимо протестировать:
- ✅ Создание новой статьи блога
- ✅ Редактирование существующей статьи
- ✅ Удаление статьи
- ✅ Изменение порядка сортировки
- ✅ Изменение статуса (активна/неактивна)
- ✅ Создание блока внутри статьи
- ✅ Редактирование блока
- ✅ Удаление блока

## Важно
Все изменения сохраняют существующую функциональность, дизайн и производительность. Изменена только реализация API запросов для корректной работы с аутентификацией.
