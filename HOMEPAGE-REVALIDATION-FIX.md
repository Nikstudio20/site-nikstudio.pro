# Исправление ревалидации главной страницы

## Проблема
При изменении контента главной страницы в админке на сервере изменения не применяются сразу из-за кэширования Next.js.

## Решение
Добавлена автоматическая ревалидация Next.js после обновления контента в Laravel.

## Что изменено

### 1. Backend (Laravel)
- **Файл**: `backend_laravel/app/Http/Controllers/Api/HomepageContentController.php`
- Добавлен метод `revalidateNextJs()` для вызова API ревалидации Next.js
- Метод вызывается после каждого обновления контента (`bulkUpdate` и `update`)
- Использует `Http::facade` для асинхронного запроса к фронтенду

### 2. Переменные окружения
- **Файлы**: `backend_laravel/.env` и `backend_laravel/.env.example`
- Добавлена переменная `FRONTEND_URL` для указания URL фронтенда

## Настройка на сервере

### Шаг 1: Обновить .env на сервере
Добавьте в файл `backend_laravel/.env` на продакшен-сервере:

```env
# Frontend URL for Next.js revalidation
FRONTEND_URL=https://your-domain.com
```

Замените `https://your-domain.com` на реальный URL вашего фронтенда.

### Шаг 2: Перезапустить Laravel
После изменения `.env` нужно очистить кэш конфигурации:

```bash
cd backend_laravel
php artisan config:clear
php artisan cache:clear
```

### Шаг 3: Проверить работу
1. Откройте админку и измените любой контент главной страницы
2. Сохраните изменения
3. Обновите главную страницу сайта (F5)
4. Изменения должны отобразиться сразу

## Как это работает

1. Пользователь обновляет контент в админке
2. Laravel контроллер:
   - Сохраняет изменения в БД
   - Очищает Laravel кэш
   - Отправляет POST-запрос на `{FRONTEND_URL}/api/revalidate`
3. Next.js API route `/api/revalidate`:
   - Получает запрос
   - Вызывает `revalidatePath('/')` для главной страницы
   - Очищает кэш Next.js
4. Следующий запрос к главной странице получает свежие данные

## Логирование
Все операции ревалидации логируются в Laravel:
- Успешная ревалидация: `Next.js revalidation triggered`
- Ошибка ревалидации: `Failed to trigger Next.js revalidation`

Ошибки ревалидации не блокируют основную операцию сохранения контента.

## Локальная разработка
Для локальной разработки используется значение по умолчанию:
```env
FRONTEND_URL=http://localhost:3000
```

## Безопасность
- Таймаут запроса: 5 секунд
- Ошибки ревалидации не влияют на сохранение данных
- API ревалидации доступен только через POST-запрос
