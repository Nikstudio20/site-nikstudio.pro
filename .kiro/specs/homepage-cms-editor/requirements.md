# Requirements Document

## Introduction

Данная фича добавляет функционал редактирования всего текстового контента и изображений главной страницы через административную панель. Это позволит администраторам управлять содержимым главной страницы без необходимости изменения кода, сохраняя при этом текущий дизайн, производительность и SEO-оптимизацию.

Главная страница содержит следующие секции:
- **Hero Section**: видео/изображение, логотип, заголовки, описание услуг
- **Main Content Section**: информация о компании, логотипы клиентов
- **Services Section**: 7 карточек услуг с изображениями, заголовками и описаниями
- **Testimonials Section**: 6 отзывов клиентов с фотографиями

## Requirements

### Requirement 1: Backend API для управления контентом главной страницы

**User Story:** Как разработчик, я хочу иметь API для хранения и управления контентом главной страницы, чтобы фронтенд мог динамически загружать данные.

#### Acceptance Criteria

1. WHEN система инициализируется THEN SHALL создать таблицу `homepage_content` с полями: id, section (string), content_type (enum: 'text', 'image'), content_key (string), content_value (text), order (integer), metadata (json, nullable), timestamps
2. WHEN создается модель HomepageContent THEN SHALL включить валидацию полей и fillable свойства
3. WHEN выполняется GET запрос к `/api/homepage-content` THEN SHALL вернуть весь контент, сгруппированный по секциям с HTTP 200
4. WHEN выполняется GET запрос к `/api/homepage-content/{section}` THEN SHALL вернуть контент конкретной секции с HTTP 200
5. WHEN выполняется POST запрос к `/api/homepage-content` с валидными данными THEN SHALL создать или обновить контент (bulk update) и вернуть HTTP 201
6. WHEN выполняется PUT запрос к `/api/homepage-content/{id}` с валидными данными THEN SHALL обновить один элемент и вернуть HTTP 200
7. WHEN выполняется POST запрос к `/api/homepage-content/upload-image` с валидным изображением THEN SHALL загрузить изображение, оптимизировать его и вернуть путь с HTTP 201
8. WHEN выполняется запрос с невалидными данными THEN SHALL вернуть ошибки валидации с HTTP 422
9. WHEN выполняется запрос к защищенным endpoints без аутентификации THEN SHALL вернуть HTTP 401
10. IF изображение превышает 2MB THEN SHALL вернуть ошибку с HTTP 413
11. WHEN контент успешно обновлен THEN SHALL очистить кеш для этой секции

### Requirement 2: Seed данных из текущего контента

**User Story:** Как администратор, я хочу чтобы текущий контент главной страницы автоматически загрузился в базу данных, чтобы не потерять существующую информацию.

#### Acceptance Criteria

1. WHEN выполняется seeder THEN SHALL извлечь все текстовые блоки из текущих компонентов и сохранить в БД
2. WHEN выполняется seeder THEN SHALL сохранить пути к существующим изображениям в БД
3. WHEN выполняется seeder THEN SHALL сохранить контент в правильном порядке (order) для каждой секции
4. WHEN выполняется seeder THEN SHALL создать записи для всех секций: hero, main_content, services (1-7), testimonials (1-6)
5. IF seeder выполняется повторно THEN SHALL пропустить существующие записи

### Requirement 3: Модификация фронтенда для динамической загрузки контента

**User Story:** Как пользователь, я хочу видеть актуальный контент главной страницы, который администратор может изменить через админку.

#### Acceptance Criteria

1. WHEN загружается главная страница THEN SHALL выполнить Server-Side запрос к API для получения контента
2. WHEN контент успешно загружен THEN SHALL отобразить динамические данные вместо hardcoded текста
3. IF API недоступен или возвращает ошибку THEN SHALL использовать fallback значения (текущий hardcoded контент)
4. WHEN отображается контент THEN SHALL сохранить все существующие CSS классы и структуру HTML
5. WHEN загружаются изображения THEN SHALL использовать Next.js Image component с оптимизацией
6. WHEN контент обновлен в админке THEN SHALL применить ISR revalidation для обновления страницы
7. WHEN загружается страница THEN SHALL сохранить текущую производительность (Lighthouse score не должен упасть)
8. WHEN загружается страница THEN SHALL сохранить все SEO meta-теги и структурированные данные

### Requirement 4: Административный интерфейс для редактирования контента

**User Story:** Как администратор, я хочу иметь удобный интерфейс для редактирования всего контента главной страницы, чтобы быстро вносить изменения без помощи разработчиков.

#### Acceptance Criteria

1. WHEN администратор открывает `/admin/homepage-editor` THEN SHALL отобразить форму редактирования, сгруппированную по секциям
2. WHEN отображается форма THEN SHALL показать все текстовые поля с текущими значениями
3. WHEN отображается форма THEN SHALL показать превью всех изображений с кнопками загрузки новых
4. WHEN администратор загружает изображение THEN SHALL валидировать размер (макс 2MB) и формат (jpg/png/webp)
5. IF изображение превышает лимит THEN SHALL показать ошибку на русском языке
6. WHEN администратор нажимает "Сохранить изменения" THEN SHALL отправить все данные на сервер
7. WHEN данные успешно сохранены THEN SHALL показать уведомление об успехе на 3 секунды
8. WHEN происходит ошибка сохранения THEN SHALL показать сообщение об ошибке с деталями
9. WHEN идет процесс сохранения THEN SHALL отключить кнопку сохранения и показать loading state
10. WHEN администратор редактирует контент THEN SHALL видеть индикатор несохраненных изменений
11. WHEN форма загружается THEN SHALL показать skeleton loader до получения данных
12. WHEN администратор изменяет текст THEN SHALL автоматически сохранять изменения в локальном состоянии

### Requirement 5: Оптимизация и кеширование

**User Story:** Как пользователь, я хочу чтобы главная страница загружалась быстро, даже при использовании динамического контента.

#### Acceptance Criteria

1. WHEN фронтенд запрашивает контент THEN SHALL использовать Next.js ISR с revalidation 1800 секунд (30 минут)
2. WHEN Laravel API получает запрос контента THEN SHALL использовать кеширование базы данных
3. WHEN контент обновляется в админке THEN SHALL очистить кеш для измененных секций
4. WHEN контент обновляется THEN SHALL вызвать revalidation для главной страницы
5. WHEN загружаются изображения THEN SHALL использовать Next.js автоматическую оптимизацию (webp, lazy loading)
6. WHEN измеряется производительность THEN SHALL сохранить Lighthouse score на уровне текущего или выше

### Requirement 6: Безопасность и валидация

**User Story:** Как системный администратор, я хочу чтобы только авторизованные пользователи могли изменять контент главной страницы.

#### Acceptance Criteria

1. WHEN выполняется запрос к POST/PUT/DELETE endpoints THEN SHALL проверить аутентификацию пользователя
2. IF пользователь не авторизован THEN SHALL вернуть HTTP 401
3. WHEN загружается изображение THEN SHALL валидировать тип файла (только jpg, png, webp)
4. WHEN загружается изображение THEN SHALL валидировать размер файла (макс 2MB)
5. WHEN сохраняется текстовый контент THEN SHALL санитизировать входные данные для предотвращения XSS
6. WHEN выполняется bulk update THEN SHALL валидировать все записи перед сохранением
7. IF валидация не прошла THEN SHALL вернуть детальные ошибки с указанием полей

### Requirement 7: Сохранение существующего функционала

**User Story:** Как владелец продукта, я хочу чтобы все существующие функции и дизайн остались без изменений после внедрения CMS.

#### Acceptance Criteria

1. WHEN загружается главная страница THEN SHALL сохранить все существующие компоненты (Header, Footer, ProjectsSection)
2. WHEN отображается контент THEN SHALL использовать те же CSS классы и Tailwind стили
3. WHEN загружается страница THEN SHALL сохранить текущую структуру HTML для SEO
4. WHEN генерируются meta-теги THEN SHALL использовать существующий SEOMetadataGenerator
5. WHEN отображаются структурированные данные THEN SHALL использовать существующий StructuredDataComponent
6. WHEN загружается hero video THEN SHALL сохранить существующую логику HeroVideoSection
7. WHEN отображаются проекты THEN SHALL использовать существующий ProjectsSection с ISR
8. WHEN загружаются отзывы THEN SHALL сохранить существующую карусель и lazy loading
