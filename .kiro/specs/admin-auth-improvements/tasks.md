# Implementation Plan

- [x] 1. Анализ и подготовка





  - Проверить текущую версию Laravel и Next.js
  - Убедиться, что Laravel Sanctum правильно настроен
  - Проверить наличие таблицы sessions в базе данных
  - Создать резервные копии критичных файлов конфигурации
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 2. Backend: Обновление конфигурации сессий





  - Обновить `config/session.php` для увеличения lifetime до 480 минут
  - Убедиться, что `expire_on_close` установлен в `false`
  - Обновить `.env` файл с новыми значениями SESSION_LIFETIME
  - Очистить кэш конфигурации Laravel
  - _Requirements: 5.1, 5.2, 5.6_

- [x] 3. Backend: Добавление поддержки "Remember Me" в AuthController





  - Обновить метод `login` в `AuthController` для принятия параметра `remember`
  - Добавить логику создания токена с разным TTL в зависимости от `remember`
  - Добавить поле `expires_at` в response
  - Обновить валидацию для включения опционального поля `remember`
  - _Requirements: 5.4, 5.5_

- [x] 4. Backend: Создание endpoint для смены пароля





  - Добавить метод `changePassword` в `AuthController`
  - Реализовать валидацию: current_password, new_password, new_password_confirmation
  - Добавить проверку текущего пароля с помощью Hash::check
  - Реализовать обновление пароля с хэшированием
  - Добавить маршрут `POST /api/admin/change-password` с middleware `auth:sanctum`
  - Добавить rate limiting (5 попыток в минуту) для endpoint
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.8_

- [x] 5. Backend: Создание middleware для автоматического обновления токенов





  - Создать новый middleware `RefreshTokenMiddleware`
  - Реализовать проверку времени истечения токена
  - Добавить логику создания нового токена за 30 минут до истечения
  - Добавить новый токен в response header `X-New-Token`
  - Зарегистрировать middleware в Kernel для admin routes
  - _Requirements: 6.2_

- [x] 6. Backend: Обновление CORS конфигурации





  - Обновить `config/cors.php` для включения `X-New-Token` в exposed_headers
  - Убедиться, что `supports_credentials` установлен в `true`
  - Проверить, что `allowed_origins` включает frontend URL
  - _Requirements: 6.4_

- [x] 7. Backend: Тестирование изменений






  - Написать unit тест для метода changePassword
  - Написать unit тест для login с remember me
  - Написать integration тест для token refresh middleware
  - Протестировать все endpoints через Postman/Insomnia
  - _Requirements: 8.6_

- [x] 8. Frontend: Обновление страницы логина для поддержки autocomplete





  - Обновить форму в `src/app/admin/login/page.tsx` для использования правильного `<form>` элемента
  - Добавить атрибут `method="post"` к форме
  - Добавить `autocomplete="username"` к полю username
  - Добавить `autocomplete="current-password"` к полю password
  - Удалить любые `autocomplete="off"` атрибуты
  - Добавить атрибут `name="username"` к полю username
  - Добавить атрибут `name="password"` к полю password
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [x] 9. Frontend: Добавление чекбокса "Запомнить меня" на странице логина





  - Добавить state для remember checkbox в компонент login page
  - Добавить UI чекбокс "Запомнить меня" в форму
  - Обновить handleSubmit для отправки параметра `remember` в API
  - Обновить логику сохранения токена с учётом expires_at из response
  - Установить правильный max-age для cookie в зависимости от remember
  - _Requirements: 5.3, 5.4_

- [x] 10. Frontend: Условное отображение Sidebar на странице логина





  - Обновить `src/app/admin/layout.tsx` для получения текущего pathname
  - Добавить условие для скрытия AppSidebar когда pathname === '/admin/login'
  - Обновить стили main элемента для полной ширины на странице логина
  - Проверить, что sidebar корректно появляется после успешного входа
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 11. Frontend: Создание страницы смены пароля





  - Создать новый файл `src/app/admin/settings/change-password/page.tsx`
  - Создать интерфейс ChangePasswordFormData с полями: currentPassword, newPassword, confirmPassword
  - Реализовать форму с тремя полями ввода пароля
  - Добавить клиентскую валидацию: минимум 8 символов, совпадение паролей
  - Реализовать handleSubmit для отправки данных на `/api/admin/change-password`
  - Добавить обработку ошибок с отображением field-specific сообщений
  - Добавить автоматическое скрытие success сообщения через 3 секунды
  - Добавить disabled состояние кнопки во время отправки
  - _Requirements: 3.1, 3.6, 3.7, 3.8_

- [x] 12. Frontend: Добавление пункта меню для смены пароля





  - Обновить `src/components/app-sidebar.tsx` для добавления нового пункта меню
  - Добавить иконку Key из lucide-react
  - Добавить пункт "Сменить пароль" с URL `/admin/settings/change-password`
  - Разместить пункт в секции настроек или отдельной группе
  - _Requirements: 3.9_

- [x] 13. Frontend: Создание централизованного API client





  - Создать файл `src/lib/api.ts` с axios instance
  - Настроить baseURL из environment variable
  - Настроить withCredentials: true
  - Создать request interceptor для добавления токена из cookie в Authorization header
  - Создать response interceptor для обработки X-New-Token header
  - Добавить обработку 401 ошибок с редиректом на /admin/login
  - Добавить обработку 403 ошибок с отображением сообщения
  - Экспортировать функции для основных HTTP методов (get, post, put, delete)
  - _Requirements: 6.1, 6.3, 6.5, 6.6_

- [x] 14. Frontend: Создание hook для автоматического обновления токенов





  - Создать файл `src/hooks/useTokenRefresh.ts`
  - Реализовать функцию для извлечения expires_at из cookie или localStorage
  - Добавить useEffect для проверки времени истечения токена каждые 5 минут
  - Реализовать логику обновления токена за 30 минут до истечения
  - Добавить обработку ошибок с редиректом на login при неудаче
  - Интегрировать hook в admin layout
  - _Requirements: 6.2_

- [x] 15. Frontend: Обновление существующих API вызовов для использования нового API client





  - Найти все прямые fetch/axios вызовы в admin компонентах
  - Заменить на использование централизованного API client из `src/lib/api.ts`
  - Убедиться, что credentials правильно передаются
  - Проверить обработку ошибок в каждом компоненте
  - _Requirements: 6.3, 6.7_

- [x] 16. Performance: Добавление dynamic imports для тяжёлых компонентов





  - Идентифицировать тяжёлые компоненты в админке (rich text editors, charts)
  - Обернуть импорты в dynamic() из 'next/dynamic'
  - Добавить loading компоненты (Skeleton) для каждого dynamic import
  - Установить ssr: false для компонентов, которые не нужны на сервере
  - _Requirements: 7.1, 7.2_

- [x] 17. Performance: Настройка кэширования API ответов





  - Установить библиотеку SWR или React Query (если ещё не установлена)
  - Обернуть API вызовы для статических данных (категории, настройки) в SWR hooks
  - Настроить revalidation intervals для разных типов данных
  - Отключить revalidateOnFocus для данных, которые редко меняются
  - _Requirements: 7.6_

- [x] 18. Performance: Оптимизация bundle size





  - Запустить `npm run build` и проанализировать размер bundle
  - Проверить использование named imports вместо default imports
  - Удалить неиспользуемые зависимости из package.json
  - Проверить, что tree-shaking работает правильно
  - _Requirements: 7.3, 7.9_

- [x] 19. Performance: Добавление compression middleware в Laravel





  - Создать middleware `CompressResponse` для gzip compression
  - Зарегистрировать middleware в `app/Http/Kernel.php`
  - Настроить compression для JSON responses
  - Проверить размер responses до и после compression
  - _Requirements: 7.5_

- [x] 20. Performance: Настройка browser caching для статических ресурсов





  - Обновить конфигурацию веб-сервера (nginx/apache) для кэширования
  - Установить Cache-Control headers для изображений, CSS, JS
  - Установить max-age на 1 год для статических assets
  - Проверить headers в браузере через DevTools
  - _Requirements: 7.5_

- [x] 21. Performance: Проверка и оптимизация изображений





  - Убедиться, что все изображения используют next/image компонент
  - Проверить правильность размеров и форматов изображений
  - Убедиться, что lazy loading включён для изображений вне viewport
  - Проверить, что priority установлен только для hero images
  - _Requirements: 7.4_

- [x] 22. Тестирование: Проверка страницы логина








  - Открыть /admin/login и убедиться, что sidebar скрыт
  - Проверить, что форма имеет правильные autocomplete атрибуты
  - Ввести credentials и проверить, что браузер предлагает сохранить пароль
  - Проверить чекбокс "Запомнить меня"
  - Проверить успешный вход и редирект на /admin
  - _Requirements: 8.1, 8.2, 8.3_

- [x] 23. Тестирование: Проверка отображения sidebar после входа





  - После успешного входа проверить, что sidebar отображается
  - Проверить, что все пункты меню работают
  - Проверить, что активный пункт меню подсвечивается
  - Проверить кнопку выхода
  - _Requirements: 8.4_

- [x] 24. Тестирование: Проверка функции смены пароля





  - Открыть страницу смены пароля через меню
  - Попробовать сменить пароль с неправильным текущим паролем
  - Попробовать сменить пароль с несовпадающим подтверждением
  - Попробовать сменить пароль с коротким новым паролем (< 8 символов)
  - Успешно сменить пароль с правильными данными
  - Проверить, что success сообщение исчезает через 3 секунды
  - _Requirements: 8.6, 8.7_

- [x] 25. Тестирование: Проверка времени жизни сессии




  - Войти в систему без "Запомнить меня"
  - Подождать несколько минут и проверить, что сессия активна
  - Проверить, что сессия не истекает в течение 8 часов
  - Войти с "Запомнить меня" и проверить cookie max-age
  - Закрыть браузер и открыть снова, проверить, что сессия сохранилась
  - _Requirements: 8.5, 5.6_

- [x] 26. Тестирование: Проверка автоматического обновления токенов





  - Войти в систему и работать в админке
  - Проверить в DevTools Network, что токен обновляется автоматически
  - Проверить, что X-New-Token header присутствует в responses
  - Проверить, что новый токен сохраняется в cookie
  - Убедиться, что обновление происходит без прерывания работы
  - _Requirements: 6.2_

- [x] 27. Тестирование: Проверка обработки ошибок авторизации







  - Удалить токен из cookie вручную
  - Попробовать обратиться к защищённой странице
  - Проверить, что происходит редирект на /admin/login
  - Проверить обработку 403 ошибок
  - Проверить, что сообщения об ошибках отображаются на русском языке
  - _Requirements: 6.5, 6.6_

- [x] 28. Тестирование: Проверка производительности





  - Запустить Lighthouse audit для админ-панели
  - Проверить размер bundle в production build
  - Проверить время загрузки страниц до и после оптимизации
  - Проверить, что lazy loading работает (компоненты загружаются по требованию)
  - Проверить размер API responses с compression
  - Убедиться, что производительность не ухудшилась
  - _Requirements: 8.9, 7.8_

- [x] 29. Тестирование: Проверка отсутствия регрессий





  - Проверить все существующие функции админ-панели
  - Проверить создание/редактирование/удаление проектов
  - Проверить создание/редактирование/удаление блог постов
  - Проверить загрузку изображений и видео
  - Проверить SEO управление
  - Проверить homepage editor
  - Убедиться, что ничего не сломалось
  - _Requirements: 8.8_

- [x] 30. Финальная проверка и документация





  - Выполнить полный checklist из requirements
  - Проверить, что все изменения работают в разных браузерах (Chrome, Firefox, Safari)
  - Проверить мобильную версию админки
  - Обновить README с информацией о новых функциях
  - Создать summary документ с описанием всех изменений
  - _Requirements: 8.10_
